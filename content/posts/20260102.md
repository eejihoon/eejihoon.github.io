+++
date = '2026-01-02T16:10:48+09:00'
draft = false
title = '2026 audit log'
toc = true
autonumber = true
showTags = true
hideBackToTop = false
summary = '01-02~'
+++

## 20260102

오늘 아침 스크래핑 대상에 5천개를 추가할 수 있느냐는 질문을 들었다. 지금 3개 병렬로 5천개를 스크래핑 해오는 것도 6시간에서 많게는 9시간까지 버거운 수준이어서 미뤄달라고 했다. 간단하게는 세션 몇 개 추가해서 병렬 추가 개수를 늘리면 될 것 같았는데 우선 새로 작업하고 있는 에이전시 모델부터 끝내고 처리하려고 미뤘다. 

스크래핑 하는 데 걸리는 시간을 대략적으로 말해주려고 Job 로그를 확인해보는데 31일부터 안 돌았다.

확인해보니 모든 CRON 관련 작업이 403 Error를 뱉고 있었다.
동시에 새로운 파트너가 결제를 했는데도 권한이 없어서 서비스 탐색이 불가능하다는 제보를 받았다.

1. 결제건에 대해
확인해보니 결제 건에 대한 문제는 만료일이 25.12.15일로 설정되어 있어서 발생하는 문제였는데 원인을 끝내 찾지 못했다. 재현이 안 되고, 똑같이 12.15 만료일로 되어 있는 건들이 수십 건 있었는데 우리가 수기로 데이터를 많이 건드리다보니 원인 추측하기가 불가능했다. 애플리케이션 코드 레벨에서 그 날짜로 넣는 코드가 없었다(시,분,일,초까지 동일한 만료일이 수십건이었음). 이상한 건 전부 시간이 좀 된 데이터였는데, 가장 최근 12.30에 결제가 일어난 건이 만료일이 12.30이라는 것은 잘 이해가 되지 않았다. 애플리케이션 코드 버그라면 만료일이 12.15일 건들과 시, 분, 일, 초까지 같을 수는 없을 것 같았는데 Trigger Function에도 만료일을 건드리는 코드는 없었다.

2. CRON 404에 대해
다른 플랫폼과 협업을 위해 에이전시 모델을 만들고 있다. 파트너에게 서브도메인 형태로 서비스를 제공하려는데, 미들웨어에 허용 가능한 호스트 도메인을 미들웨어에 설정해뒀다가 아예 라우트로 접근을 못하고 403으로 튕겨나가는 이슈가 발생한 것이다.

```ts
const ALLOWED_HOSTS = [
  'example.com',
  'localhost',
  '127.0.0.1',   // 로컬 IP (curl 테스트용)
];

// ---- HOST VALIDATION ----
const isAllowedHost = ALLOWED_HOSTS.some(host =>
  hostname === host || hostname.endsWith(`.${host}`)
);

if (!isAllowedHost) {
  return new NextResponse('Forbidden', { status: 403 });
}
```

호스팅된 서브도메인으로 호출되는데, ALLOWED_HOSTS에서 막히는 것이다. 이렇게까지 강하게 제한할 이유는 없었는데 Claude Code가 제안하는 코드를 따르다보니 아무 생각없이 머지했다. 다행히 예약 메시지 발송 말고 사이드 이펙트는 없었다. 다만 아침부터 예약된 메시지가 한번에 발송되지 않도록 모두 취소하고, 다시 재발송 되도록 만드는 코드를 추가로 작성했다.

이 문제들을 해결하는 중에도 ig 로그인 관련 문의가 들어왔다. 로그인과 Captcha까지 해제했는데 비밀번호가 틀렸다고 한다거나, 로그인을 시도하는데 로그인 화면에서 멈춘다. 1번은 메타 이슈로 우리가 해결할 수 없고 2번은 백로그에 두고 다시 확인해봐야 한다.

연락처가 일원화 되어 있지 않아서 세 군 데 연락처가 저장된다. 연락처가 있는데 왜 알림톡으로 발송되지 않고 DM으로 발송되는 것인지 문의가 들어왔다. 이것도 버그일 거고 나중에 살펴봐야 한다.

---

오늘은 31일에 만들어둔 에이전시 모델 배송지 관리 페이지를 불필요한 코드를 지우고 구현하지 않아도 될 코드를 라이브러리로 대체하고 그런 작업을 계속 반복하고 있다. 클로드 코드가 작성한 코드를 살펴보면서 필요한 부분만 남기고 지워나가는 게 시간이 오래 걸린다. 처음부터 필요한 부분만 필요한 라이브러리를 사용해서 구현하게 할 수는 없을까? 처음부터 코드를 잘 썼으면 괜찮았을지도 모른다. 하지만 이미 스파게티 코드가 되었다. 그럼 스파게티 코드 속에서 어떻게 앞으로 작성할 코드만 불필요한 보일러 플레이트 없이 필요한 부분만 작고 간단하게 잘 만들 수 있을까? 일단 CLAUDE.md를 재작성하고 code-reviews SKILLS를 만들었다. 

```
코드 작성 전 반드시 확인:

[ ] src/hooks/에 재사용 가능한 훅이 있는가?
[ ] src/lib/utils/에 유사 유틸리티가 있는가?
[ ] src/components/ui/에 Shadcn 컴포넌트가 있는가?
[ ] 이 문제는 TanStack Query로 해결되는 표준 패턴인가?
직접 구현 금지 항목:

드롭다운/셀렉트 → Shadcn Select 사용
모달/다이얼로그 → Shadcn Dialog 또는 AlertModal 사용
외부 클릭 감지 → Radix 기본 제공 기능 사용
데이터 페칭 상태 관리 → TanStack Query 사용
URL 쿼리 파라미터 → useFilterParams 훅 사용
```

이 외에도 상세 가이드가 있다. 지켜보면서 내용 추가하는 걸로.

예전부터 보이던 건데 actions에 인증 로직이 너무 중복된다 싶어서 찾아보니 미들웨어랑 중복으로 인증 처리를 하고 있었다.
Next.js에서는 DAL 패턴을 권장한대서 그렇게 수정하는 중이다. DAL 패턴이란? Data Access Layer의 약자로, 데이터베이스와 같은 데이터 저장소에 접근하는 로직을 추상화하여 코드의 복잡성을 줄이고 유지보수성을 향상시키는 패턴이다. Next.js 권장이라는데 왜 몰랐을까? 지금 이 작업을 하는 게 맞을까? 근데 멈출 수가 없다. 미들웨어와 서버 액션에 이중 인증 중복이 있는지 오늘에서야 알았다는 게 어이가 없다. 코드를 거의 안 읽기 때문에 놀랄 일도 아니지만. 난 자격이 없다는 생각이 든다.

-- 

TODO:
- 연락처가 있는데 알림톡 발송 안 되는 이유


## 20260103.

성수집에 가서 이삿짐 정리했다. 집으로 돌아와서 다시 컴퓨터 앞에 앉았다. 오늘 아침에 Claude code 작성자 Boris cherny의 X에 올라온 본인이 클로드 코드를 사용하는 13가지 방법을 공유한 [트윗](https://x.com/bcherny/status/2007179832300581177)을 읽었다. 대단한 내용은 없지만 commit이나 review처럼 매번 내가 타이핑해서 시키는 작업을 커스텀 커맨드로 만들어두고 재사용해야겠다는 생각을 해서 집에 와서 commit과 review custom command를 만들었다. 그리고 어제 하던 DAL 마이그레이션 작업을 마무리 했다. 스파게티 코드가 가장 많은 크리에이터 관련 로직은 아직 수정하지 않았다. 캠페인이나 제안 관련된 코드들을 수정했다. 

어제 결제 버그를 잡아냈다. 다행히 애플리케이션 코드 레벨 문제가 아니라 Trigger Function에서 직접 건드리고 있었다.

```
🎯 발견한 Trigger Function

트리거 이름: trigger_function
실행 함수: apply_pre_registration_benefits()
실행 시점: 테이블에 INSERT될 때

📝 함수 동작 방식

1. specialty가 'fashion'인 경우에만 실행
2. 브랜드 유저의 이메일을 조회
3. 사전 등록 테이블에서 해당 이메일이 사전 등록되어 있는지 확인
4. 사전 등록자라면:
  - 구독 플랜 업그레이드
  - 특정 만료일로 설정
  - 사용 한도 조정
  - Slack으로 알림 발송

💬 메시지 발송 부분

PERFORM public.notify_slack(
  format('사전 등록 브랜드(%s) 가입 확인! 혜택이 자동 적용되었습니다.', v_user_email)
);

변수: v_user_email - moody.brand_users.email에서 조회한 이메일 주소

이 함수는 public.notify_slack() 함수를 호출하여 Slack으로 메시지를 전송합니다.
```

원인을 찾아서 찝찝한 마음이 사라졌다.

구독 > 서비스 사용 > 구독 취소 > 재결제 > 구독 실패 하는 케이스가 있어서 알아봤더니 의도한 동작이었다. Active Plan이 이미 있는데 다시 결제하는 경우, 다개월 결제를 했다가 환불해서 다개월 Active Plan이 있는 상황에서 다시 새로운 plan을 구독할 때 어떻게 할 건지 아직 구체적으로 정해두지 않았기 때문이다. 당장 그런 케이스까지 나오지 않을 것 같아서 구현을 미뤄뒀었다.

worktree script, pr-write, commit custom command 만들고, 거슬리던 어드민 페이지 하나 개선했다. page.tsx에 몰빵해서 너무 커진 페이지를 여러개의 컴포넌트와 hooks로 분리했다. 다개월 구독 시 usage renewal 로직을 제거하고 결제 즉시 다개월 usage를 만들어두도록 수정했다. 간단한 구현인데 왜 이렇게 복잡하게 생각했을까? usage 갱신 크론까지 만들어가면서. 도서관에서 돌아오는 길에 문득 usage를 미리 생성해두면 되잖아? 하는 생각이 들어서 수정했다.

next.js guide를 좀 열심히 읽어야지.

## 20260104

이른 아침부터 형이랑 성수집 짐을 서울여대 사무실로 옮겼다. 2년 전에 녹양동에서 성수동으로 왔었는데 시간이 빠르다. 항상 제때 집을 못 구해서 두 번이나 이사를 해야 하는데도 군말없이 매번 무거운 이삿짐을 옮겨주는 형에게 고맙다.

집 돌아와서 다시 작업. 어제 어드민 페이지를 리팩토링 하다가 CLAUDE.md를 읽더니 Button.tsx 컴포넌트가 Shadcn으로 작성되어 있지 않다고 해서 전체 업데이트를 했다. 커스텀 구현을 라이브러리 코드로 바꾼다고 해서 당장 좋아지는 것은 없으나 특별한 이유가 있지 않고서 shadcn에 이미 구현되어 있는 컴포넌트를 쓰는 게 여러모로 안전한 것 같다. 어느 순간부터 Claude code가 다음 대답까지 예측해서 미리 준비해둔다. 결정하는 일은 언제나 어렵지만 한편으로는 내가 정말 결정을 하고 있는 것인지도 모르겠다. 에이전트랑 일하면서 어느 순간 통제력을 잃어버리는 것 같다. 어떻게 코드가 작성되어 있는지도 잘 모르겠고 나도 모르는 사이에 어떤 문제가 터지지는 않을지, 이미 터진 것은 아닐지 두려워질 때가 많다. AI가 하는 만큼 내가 인지할 수 없는 상황에서 어떻게 통제력을 되찾을 수 있을까? 그냥 조금씩 필요한 부분, 내가 잘 모르겠는 부분을 다시 탐색해나가야겠다는 생각은 하지만, 내 노력과 별개로 통제 가능한 시스템을 구축할 수 있을지 고민이 계속 필요하다.

## 20260105

여섯시 반에 일어나서 영어 듣기 하고 버스타고 출근했다. 버스에서 ELOQUENT JAVASCRIPT를 읽었다.

오전에 세 가지 문제를 공유 받았다.

1. 다른 캠페인에서 이미 제안한 크리에이터가 다시 추천 되어서 같은 크리에이터들에게 제안을 반복한다.
2. 제안 관리에서 크리에이터 확인 불가 / 리빙 서비스에서 패션 서비스 제안 목록 조회 가능한 문제
3. 인스타그램 로그인 시 세션 체크 못함.

그리고 오후에 하나 더 생겼다.

4. 상품 옵션을 지정했는데 지정하지 않고 수락하는 케이스가 있다는 것. 옵션은 필수값인데 누락됐다면 버그다.
이건 이미 수정한 이슈다. 어드민에서 캠페인 대리 제안 기능을 만들었는데 캠페인에서 등록된 상품 옵션을 선택 가능하게 제안 시에도 옵션으로 제공해야 하는데 제안 시 옵션 복사가 안 됐다. 캠페인 옵션과 제안 옵션이 다른 이유는 제안할 때 특정 옵션을 제외할 수 있는 기능을 제공하기 위해서였는데 단순화 과정에서 해당 기능이 없어졌다. 불필요하게 옵션이 이중화 되어 있는 셈이다. 일단 어쩔 수 없다.


1번 문제였던 비슷한 사람들이 여러 캠페인에 걸쳐서 추천되는 문제는 최근 제안한 200명을 추려서 50명 단위로 패널티를 주는 방식으로 해결했다. 최근 50명 안에 포함된다면 *0.2, 최근 100명 안에 포함되면 *0.5 하는 방식이다.

2번 문제는 이상하게 재현이 안 된다. 크리에이터 프로필 페이지로 이동하는 것도 정상 동작하고, 리빙 <-> 패션 크로스 체크해봐도 하나의 분야가 다른 분야의 제안을 조회할 수 없다. 하지만 버그 제보에는 분명히 리빙에서 패션 제안을 조회하고 있다. 데이터를 최대한 비슷하게 꾸려놔도 재현이 불가능하다. 그것 외에 제안 관리 페이지 필터가 분야를 구분하지 않고 통계를 내는 문제가 있어서 수정했고 useEffect, useState로 API Fetch 해오던 부분을 TanStack Query로 변경했다.

H x MOODY 서비스 워크플로우

**(셀러) 캠페인 요청서 작성 -> (무디 어드민) 대리 제안 -> (셀러) 수락한 크리에이터 중 최종 선택 -> (셀러) 콘텐츠 유형에 맞는 금액 정산 -> (셀러) 상품 발송 -> (무디 어드민) 크리에이터 대리 정산 -> (셀러) 완료된 캠페인 콘텐츠 다운로드**

**셀러 서비스**
1. 캠페인 요청서 작성 (미로그인 폼으로 작성하거나 로그인해서 직접 캠페인 생성 가능)
2. 수락한 크리에이터 중 최종 선택
3. 콘텐츠 유형에 맞는 금액 정산
4. 상품 발송
5. 완료된 캠페인 콘텐츠 다운로드

**무디 어드민**
1. 셀러 캠페인 대리 제안
2. 셀러 캠페인 대리 정산


**결제 방식 재논의**

```
결제 시점과 방식을 어떻게 할지
1안) 선결제 방식 - 결제 링크
캠페인 요청서 작성하고, 무디에서 진행 가능 메일 회신 보낼 때 결제 링크 전달
2안) 선결제 방식 - 결제 플로우
캠페인 요청서 작성하고, 결제하기 플로우 제공
3안) 중간 결제 방식
크리에이터 선정 시점에 결제하기 플로우 제공
```

크리에이터는 모였는데 정산하지 않는 경우를 방지하기 위해 3안을 제외하고 1, 2안 중 1안으로 결정.
캠페인 요청서 작성 후, 회신 메일 발송할 때 필요한 결제 링크를 만들어야 하고, 캠페인 진행 과정에서 결제 단계는 생략한다.


**예외 상황**
1. (셀러) 수락한 크리에이터 중 최종 선택
2. (셀러) 콘텐츠 유형에 맞는 금액 정산

셀러는 크리에이터를 최종 선택하고 콘텐츠 유형과 개수에 맞는 금액을 정산한다.
정산 이후에 수락되는 건들에 대한 논의 필요.

> 답변: 우선 기존 플로우대로 한다는 가정하에, 최종 선택 후 수락 건에 대해서는 기본 룰은 반려하고, 상황에 따라 파트너에게 추가 수락건에 대해서 진행 유무 문의 후 드랍

버스 타고 퇴근할 때마다 멀미하는 것 같다. 머리 아프고 어지럽고 울렁거린다.

## 20260106

5시 30분에 6시 30분인 줄 알고 깼다. [The Pragmatic Engineer in 2025](https://newsletter.pragmaticengineer.com/p/the-pragmatic-engineer-in-2025) 읽었다. 요새 A Philosophy of Software Design 이 책 제목을 자주 마주치는 느낌인데, 아쉽게 번역서가 없다. 저자 John Ousterhout과 Gergely Orosz가 The philosophy of software design이라는 제목으로 [팟캐스트](https://newsletter.pragmaticengineer.com/p/the-philosophy-of-software-design)를 진행했는데 생각해보니 작년에 제목에 끌려서 LylisAI로 요약해서 팀에 공유했던 기억이 난다. 나도 풀 비디오를 보지는 않았는데 TDD나 클린 코드에 관한 견해가 재밌었다. TDD와 클린 코드의 도그마 속에서 그렇지 않다고 주장하는 것이 흥미로웠다. 찾아보니 uncle bob과 ousterhout가 만나서 토론도 진행했던 모양이다.

- 테스트가 필요한 가치라고 보면서도 TDD는 전술적(tactical)이어서 오히려 설계를 약하게 만든다고 본다. 
- 개발의 기본 단위를 테스트 1개로 만들면서 사고 단위가 지나치게 작아진다.
- 작동하는 나쁜 코드가 쌓일 위험이 있다.
- 테스트를 문서로 보는 관점에 동의하지 않고 코멘트가 더 효율적이다.
- Outsterhout은 TDD의 대안으로 더 큰 단위의 메서드 혹은 클래스를 먼저 설계-구현한 뒤 곧바로 단위 테스트를 작성하고, 테스트가 갖춰지기 전엔 완료로 보지 않는 방식을 제안했다. 
- 그러면서 예외적인 상황에서 버그를 고치는 경우 테스트 퍼스트가 유용한 점을 인정한다.

결론은 Clean Code든 APOSD든 테스트는 중요하다는 것이다.

7시 30분까지 Ethan Hawke의 Give yourself permission to be creative 비디오를 들었다.

직렬 독서 계속 도전 중이다. 버스타고 오면서 ELOQUENT JAVASCRIPT 읽었다. 버스에서 비동기 부분을 다 읽었다. 주말에 코드도 쳐봐야지. Javascript 코드는 눈으로 읽어서 잘 이해가 안 간다.

출근해서 ig scraper가 프로세싱 상태로 긴 시간 처리되지 않는 케이스가 많아서 10분 이상 프로세싱 중이면 다시 대기 상태로 돌리는 풀링 워커를 작성했다.

공차 마시면서 넥스트 논의. 플랫폼 협업. 버티컬 확장. AI 분석 고도화, 어필리에이트, 자동화 에이전트 등등. 할 일이 많다.
서비스 개발 초기에 대여섯 개 터미널을 열어놓고 병렬 작업을 했는데 어느 순간 내가 무슨 일을 하고 있는 것인지도 모르겠어서 멈췄다. 지금도 가끔 2-3개 병렬로 작업하지만 최대한 한 번에 하나의 일에 집중하려고 한다. 한 두 개 정도 작업을 병렬로 진행하는 것을 시도해봐야겠다.

사용자가 늘어나기 전에 모니터링 시스템 구축해야 한다. 주말에 시간 내서 봐야지.

다시 파트너 플랫폼 작업. AI로 초안 잡고 세부사항 맞추는 게 오래 걸린다. 콘텐츠 다운로드까지 했다.
콘텐츠 관리 페이지에서 업로드 한 이미지를 모두 조회할 수 있어야 한다는 생각이 문득 들었다.

광고 모아보기 페이지에 브랜드 검색 추가 기능 업데이트가 있었다. 좀 느리다고 하길래 살펴보다가 불필요해 보이는 캐시 레이어가 만들어져 있어서 제거를 제안했다. 똑같은 쿼리일 때 같은 결과를 반환하는 캐시 레이어였다. 60초 동안만 유효했다. 클라이언트에 TanStack Query가 Stale 상태가 되기 전까지 그 역할을 대신할 수 있고, 그게 아니더라도 캐시 자체가 느린 쿼리를 해결할 수는 없다고 생각했기 때문이다. 다음과 같은 ORDER BY가 추가 되었다.

```sql
ORDER BY (
  LN(en) * 2 +
  r_score / 100 +
  a_score / 5 * 2 +
  1 / (1 + EPOCH(NOW() - taken_at) / 604800)
) DESC
```

보통의 개발자라면 이런 쿼리를 눈 감고 지나갈 수 없다고 생각한다. 직감적으로 이건 아닌 쿼리가 있는데 이 경우 이건 아님에 해당했다. 그래서 중요도가 높은 게 아니라면 단순화를 제안했더니 API로 변경하면 안 되는 것인지, 로컬에서는 괜찮은데 고객에게 문제가 발생하는 것인지 등등 질문이 돌아왔다. API로 바꾸면 안 되느냐는 말에 달리 무슨 말을 할 수 있을까? 해당 ORDER BY가 비즈니스에서 중요한 정렬이라고 해서 사전에 미리 계산한 값을 쓰기로 했다. 커피를 내렸다.

고씨네 돈까스 먹었다. 의외로 돈까스 맛집이다. 서울여대 후문 들어오는 길에 아파트 방송으로 바깥으로 담배꽁초나 음식물 쓰레기 버리지 말라는 안내방송이 흘렀다. 세상 모든 아파트에서 같은 말을 반복하고 있는 것 같다는 생각이 들었다.

캠페인 생성 > 제안 > 확정 > 출고 > 콘텐츠 다운로드, 대시보드 / 캠페인 관리 페이지까지 얼추 완성했다.

이제 남은 것
- 미로그인 상태로 캠페인 요청 폼
- 관리자 페이지에서 제안/역제안 관리
- 콘텐츠 요청 명세에 따른 결제 페이지 생성
- 취소/환불 절차 (토스페이먼츠 관리자에서 수동 취소 가능)

퇴근 전. 팀에 파트너 어드민 공유함

Weekends TODO
- ELOQUENT JAVASCRIPT 타이핑
- 모니터링 리서치
- npm run build warning 제거

버스 타고 ELOQUENT JAVASCRIPT 읽으면서 퇴근. 1132번 타고 한 정거장 미리 내려서 100번 버스 정류장까지 좀 걸어야 했다.

## 20260107

06:30 알람 맞추고 06:45 기상
06:50 ~ 07:30 영어 공부
07:30 ~ 08:00 출근 준비
08:00 ~ 08:30 커피 타임
08:30 ~ 09:00 ELOQUENT JAVASCRIPT 읽으면서 출근. 프로그래밍 언어 만들기 챕터. 어렵지만 해보고 싶고, 읽을 수록 내공이 대단한 책 같음. 어떤 도구를 내 생각대로 다룰 수 있을 정도로 수련하기 위해서 얼마나 연습했을지 상상하기 어려움.

- 아침에 출근해서 크리에이터가 아닌 인스타그램 사용자에게도 콜드 DM 보낼 수 있도록 기능 추가함.
- IG 스크래퍼가 거의 동작하지 않음. 어제 풀링 워커 추가하고 1000명 스크래핑 할 때까지 문제 없었는데 원인 파악 필요

오늘 할 것
- 미로그인 상태로 캠페인 요청 폼
- 관리자 페이지에서 제안/역제안 관리
- 콘텐츠 요청 명세에 따른 결제 페이지 생성
- 취소/환불 절차 (토스페이먼츠 관리자에서 수동 취소 가능)
- 파트너에게 가는 모든 알림톡 제거

밥 먹고 산책하다가 생각난 것
- campaign request를 별도로 운영해야 할까? 외부적으로 그렇게 노출하더라도 내부적으로 campaigns로 통일해야 하지 않을까? 아니면 언제나 동기화 해주던지. 캠페인 요청서와 캠페인이 분리되어 있으니 로그인할 때 첫 캠페인이 없는 상태다. 이 문제를 해결하려면 생성할 때 캠페인도 같이 생성하거나, 캠페인 요청서도 내부적으로는 캠페인으로 동작하기 해야 한다. 일원화 하는 게 나을지, 동기화 하는 게 나을지?

이슈
- OGT에서 결제하려는데 카드 등록이 안 된다고 함.
 - 처음 한 번 재현이 됐는데 토스페이먼츠에서 거절했다는 문제였고 우리 서비스 로그, 토스페이먼츠 관리자 페이지에 흔적이 남아 있지 않았음.
 - 카드 등록 시 로그 추가해둠
 - PRO 플랜이 이미 있을 경우 결제가 안 되는 문제가 있어서, 수동으로 넣어준 PRO 플랜(빌링 키 없음으로 판단)일 경우 유료 구독 가능하도록 변경

 미로그인 상태로 캠페인 요청 시 자동 가입 + 계정 이메일 발송 등등 끝냈다. 요청 테이블 별도로 두지 않고 캠페인이랑 통합했다. UI 일관성도 맞췄다. 세부사항들 조금 더 테스트 하고 결제로 넘어가도 되겠다.
 
 저녁 샐러디 시켰다. 삼겹 들기름 파스타 샐러드.
 
캠페인 생성 시 결제 페이지 자동 생성 - 결제 기능까지 붙였다. 환불은 나중에.
- 캠페인 관리
  - 파트너 캠페인을 대신 수정할 수 있어야 함
  - 역제안이 오는 경우 수락하거나 다시 제안할 수 있어야 함.

오늘 마무리: 6개 PR 올렸다.
- DM 메시지 예약 기능에 크리에이터 아닌 사용자의 인스타그램 username 추가
- 파트너 캠페인 요청서
- 파트너 캠페인 요청, 캠페인 폼 통합
- 파트너 캠페인 결제 
- 캠페인 관리 어드민
- ig scraper keep-alive 추가
- 원고료 증빙 PDF 다운로드 (갑자기 생긴 일)

비밀번호 찾기, 비밀번호 변경, 비밀번호 재설정 등등.. 자잘한 것들까지.

## 20260108

06:50 ~ 07:30 영어 공부 (Ethan Hakwe Ted, AI Engineer YouTube)

버스타고 09:10 출근했다. 춥다.
오늘도 여전히 ig-job이 돌지 않았다. 어제 대충 Keep-Alive 원인이라고 떼웠던 것이 잘못된 추측이었던 것. Keep-Alive란 무엇인가? “HTTP Keep-Alive는 매 요청마다 TCP 연결을 새로 맺을 때 발생하는 핸드셰이크와 RTT 오버헤드를 줄이기 위해, 한 번 맺은 TCP 연결을 유휴 타임아웃 동안 재사용하는 메커니즘이다. HTTP/1.1에서는 기본적으로 지속 연결을 사용하며, 연결을 끊고 싶으면 `Connection: close` 헤더를 보낸다. 왜 Keep-Alive가 문제였나? 이건 명백히 내가 너무 대충 클로드만 믿고 넘어간 잘못이다. HTTP Keep alive 설정도 아니고 TCP Keep Alive 설정을 해뒀다. TCP 레벨 Keep Alive는 OS 레벨에서 TCP 연결 활성 여부 확인 패킷을 전송한다고 한다. 에러 로그가 Connection terminated due to connection timeout여서 DB랑 연결이 끊겨서 그랬던 것 같다. 하지만 PgBouncer는 애플리케이션 레벨에서 쿼리가 없으면 연결을 종료하고 TCP가 살아있어도 idle timeout이 되면 연결이 끊긴다. 진짜 원인은 이거다.

```
PgBouncer server_idle_timeout: ~10초
pg Pool idleTimeoutMillis: 300초 (5분)
```

시나리오:
1. T+0s: pg Pool이 연결 획득, 쿼리 실행
2. T+1s~60s: 스크래핑 진행 (DB 쿼리 없음)
3. T+10s: PgBouncer가 idle 연결 종료 (pg Pool은 모름)
4. T+61s: 스크래핑 완료, DB 저장 시도
5. pg Pool이 죽은 연결로 쿼리 시도 → 에러 → Worker 크래시

pg Pool이 PgBouncer보다 먼저 연결을 닫도록 설정:
- min: 1 → 0 (idle 연결 유지 안 함)
- idleTimeoutMillis: 300000 → 5000 (5분 → 5초)
- keepAlive 관련 설정 제거 (효과 없음)

--

OGT가 여전히 카드 등록이 안 된다고 문의가 왔다. 정말 감사하고 죄송하다. 재현이 안된다. 데이터를 똑같이 만들고 카드 등록을 시도해도 재현이 안 된다. 정확한 원인 파악을 위해서 계정 정보를 받기 위해 급히 비밀번호 변경 기능을 만들었다. 계정 정보를 받아서 시도했지만 재현이 불가능했다. 카드 정보 입력에 오류가 있었던 것 같다.

오전..은 언제나 이슈 해결로 보내는 것 같다. 뭐가 이렇게 맨날 안 될까?

하루가 정신 없이 갔다. 벌써 여섯 시.
산책하면서 don이 한 말. 뭘 예측하든 다 틀리는 것 같다. 그래서 잘 모르겠고 빨리 해보고 싶다. 

오전 시간 이런저런 이슈 해결하느라 보내고, 오후에 와서도 관리자 페이지 만들고 파트너 어드민 만들고 하느라 순식간에 하루가 다 갔다. 파트너 신청 열기도 전에 어떻게 알고 들어와서 신청했고 매출이 바로 발생했다.

가정의 날이라 여섯 시 퇴근하고 집에 와서 안성탕면이랑 남은 치킨 먹었다. 빨래 개고 청소기 돌리고 집 정리 좀 하니까 아홉시 다 됐다. 잠깐 릴스 봤는데, 보려고 본 것도 아니고 손이 가서 봤는데 한 삽십분이 훅 지난 것 같다. 책 읽는 시간 마련하려고 이번주 내내 버스 타고 다녔는데, 30분이면 얼마나 많은 분량을 읽을 수 있는데 릴스에 30분을 쓰다니 너무 아깝다. 그런 거 알면서도 계속 스크롤 못 멈추는 것도 짜증나고.

아 그리고 갑자기 subdomain https가 만료되는 문제가 생겼다. 이건 Vercel / Cloudflare에서 내가 뭔가 잘못한 것 같은데 더 파봐야 한다. 일단 Vercel에 직접 서브도메인 입력하니 해결되었음.


## 20260109

파트너 플랫폼 고민:
- A 크리에이터 역제안을 수락하면 크리에이터는 알림톡을 받는데, 파트너가 선정하지 않는 경우 이후 추가 액션이 없어서 혼란이 발생할 수 있다.
- 모집 완료 > 파트너 선정까지 완료된 이후에 수락한 크리에이터들은 orphan 상태로 남는다.

> 진행 보류 알림톡 일괄/개별 발송 기능 추가

오늘도 정신없이 하루가 갔다. 벌써 일곱시. 오늘까지 만들기로 했던 것들 대부분 끝났다. 파트너 - 에이전시 모델 플로우를 모두 만들었다. 이제 파트너 어드민만 남았는데 성과 관리 리포트도 포함되어야 한대서 월요일까지 시간을 쓸 것 같다. 성과 관리 테이블에 아무것도 쌓이지 않고 있었다. 무려 0건이었다. 아무도 안 쓰는 기능이었다는 뜻이겠다. 설계를 좀 손보고.. Claude Code에게 임시 방편을 원하지 않고 근본적인 해결을 원한다고 자주 말하는 것 같다. 그게 근본적인 해결이 맞아? 근본적인 원인이 뭐야? 나를 이해 시켜.. 여러가지 대안을 두고 고민하고 싶어. 전문가의 관점에서 리서치해.. 등등. 이번 파트너 페이지 작업에서 로그인, 요청폼이 제일 마음에 든다. 화면을 반으로 갈라서 한쪽엔 소개글 한쪽은 입력폼. 오늘도 결제가 있었다.

오늘도 이른 아침에 일어나서 영어 공부 했다. 어젯밤에 ELOQUENT JAVASCRIPT 다 읽었다. 좀 띄엄띄엄 읽기는 했지만. 이전에 읽다 만 `LLM 프로덕션 엔지니어링` 다시 읽기 시작했는데 너무 실습 위주라 읽는 재미는 그닥. 프로그래밍 관련 책들은 대부분 실습이 포함되어 있어서 읽는 동안 죄책감 든다. 눈으로 읽는 것은 별로 도움이 되지 않을 거라는 생각도 들고. 다음 책으로 칩후옌의 `AI 엔지니어` 읽어보고 싶고 아니면 미뤄뒀던 그러나 언제나 몇 장 읽으면 포기하게 되는 마틴 클레프만의 DDIA를 읽어볼까? 즐거운 주말이 될 것 같다. 아무튼 이번 평일 성실하고 건강하게 지냈다. 핸드폰 만지는 시간도 많이 줄었다. 주말까지 유지할 수 있을까?

## 20260110

어제는 조금 일찍 퇴근하고 상봉역 집 보러 다녀왔다. 위치나 컨디션은 맘에 들었으나 대출이 불가능할 것 같아서 패스.
어제 무슨 일이 있건 오늘도 여섯시 반에 일어나서 영어 공부했다. 오늘 아침에 다른 집 하나를 더 보았고 월요일에 은행 다녀와서 계약금을 넣으려고 한다. 아마 그 집에 살게 될 것 같다. 광화문 교보문고에 갔다. AI Engineer는 좀 훑어보니까 내가 읽을만한 책은 아닌 것 같았다. 리액트 관련 책을 읽고 싶어서 봤더니 러닝 리액트나 전문가 리액트 어쩌고 하는 책이 있었는데 전문가 리액트는 내가 리액트 전문가는 아니어서 패스. 러닝 리액트는 너무 오래 되어서 패스했다. 국내에서 나온 <다시 깊게 읽히는 리액트>라는 책이 실용적인 내용을 많이 담고 있는 것 같아서 살까 고민했는데 너무 넓은 범위를 다루기도 하고 표지가 마음에 안 들어서 나중으로 미뤘다. 조금만 더 얇았어도 샀을 텐데. 검증된 사람의 검증된 책만 읽고 싶어하는 것 같다는 생각이 들었다. 페이스북에서 여러명이 샀다고 자랑하던 <Programmer at work>를 나도 샀다. 백페이지가량 읽었고 잘 산 것 같다. 난 이런 인터뷰류 책을 좋아한다. <거장의 노트를 훔치다>, 마음산책에서 나오는 영화 감독 인터뷰 시리즈나 프로그래머로 사는 법 등등.. 거장들의 인터뷰를 읽는 것만으로도 동기부여가 된다. 70-80년대 인터뷰라 옛날 이야기를 듣는 것도 재밌다. 그 당시 신기술이었던 시디롬에 대해 "대용량 저장장치"라고 표현하는 것도 재밌고. 페이스북에서 누군가 소프트웨어 분야는 거장들이 대부분 살아있어서 그 사람들과 동시대를 살아가고 있다는 것이 매력 중 하나라는 포스팅을 봤다. 책에서나 읽던 이야기가 죽은 사람들 이야기가 아니라 불과 2~30년 전에 내 대선배가 겪은 일이라는 것. 그런 것은 좀 신기하긴 하지.

내일은 ig scraper 컨테이너가 제대로 동작 안했던 것 좀 자세히 확인해보고 파트너 어드민 미리 작업해두려고 한다.

## 20260111

여섯시 사십 분에 일어나서 영어 공부 했다. 그리고 책 읽고 밥 먹었다.
파트너 어드민 월요일에 해야 할 일들 미리 좀 해뒀다. Cron 에러 나는 것들도 손봤다.


내일 확인할 것
- 어드민이 어드민을 초대할 수 있어야 할 텐데 그러려면 수퍼 어드민 기능도 필요할 것 같다.

## 20260112

보류 알림톡 발송 가능 상태에 협의 중 상태를 추가했다. 하지만 여전히 협의 중 상태일 때 발송할 수 없다고 해서 확인해보니 상태가 세 곳으로 나누어져 있었다. 난 그 중 한 곳만 수정했다. 물론 코드를 직접 확인하지는 않았다. 하지만 협의 중 상태를 추가하고 한 번이라도 협의 중 상태를 만들어서 발송 버튼을 눌러봤다면 이런 문제는 발생하지 않았을 것이다. 스프레트시트 T/MAKER의 설계자 피터 로이즌의 인터뷰 일부다.

> 저는 제가 작성한 코드를 신뢰합니다. 직접 맏는 프로그램의 가장 뛰어난 사용자는 아니지만, 제가 만든 프로그램을 계속 사용하고 있으므로 단점을 잘 인식하고 있으며, 뭔가 이상한 내용을 발견하면 바꿀 수 있습니다. 세계은행에서 일하던 시절 어떤 프로그램을 누군가에게 시연하려 했던 상황을 기억합니다. 그 프로그램은 다른 사람이 만들었고, 저는 한 번도 사용해 보지 않았습니다. 화면에 첫 행이 뜨면서 도움말을 보려면 HELP라고 입력하라고 제안하는 걸 보고, 저는 첫 단계부터 일이 잘 풀린다고 생각했습니다. 그래서 HELP라고 입력했는데 "치명적인 오류 - 컴퓨터 기능 프로그래밍 부서에 연락하세요."라는 메시지가 나왔습니다. 자신이 화면에 출력한 첫 명령어조차도 따라 해 보지 않은 설계자의 사례입니다. 자신이 만든 프로그램을 결코 사용해 보지 않은 것이었습니다. 이는 프로그래밍에서 아주 위험한 방식입니다.

내가 만든 프로그램을 내가 직접 사용해 보아야 한다.

쉽지 않은 하루였다. 은행을 따지고보면 다섯 군데를 돌았다. 한 곳에서만 '요건은 맞는다'는 얘기를 들을 수 있었다. 그것도 해봐야 하는 것이겠지만 말이다. 이런 상황까지 생길 줄은 상상 못했다. 어쨌거나 눈이 많이 내렸다. 오전 내 은행을 돌았고 회사 갔다가 점심만 먹고 퇴근해서 다시 은행 돌고 집에 왔다. 주말에 도조 커피에서 산 케냐 토마토 원두를 내려 마셨다. 레시피가 있길래 오랜만에 레시피대로 내렸다.


## 20260113

버스가 파업이어서 전철 타고 왔다. 화랑대역 내려서 걸어오긴 처음이다. 이십분 정도 걸었다. 운동장에 아무도 밟지 않은 눈이 있길래 밟으면서 걸었다. 오늘은 알람이 울리기 전에 일어났다. 어젯밤에 게보린 먹고 누워서 그런지 잠이 안 왔다. 잠이 들었던 것인지 어느 순간에 내가 잠이 든 건지 여태 못 잔 건지 잘 모르겠다는 생각이 들었다. 그리고 여섯시쯤 깼다. 자면서 계속 깼는데 깰 때마다 지금이 일곱시거나 그쯤 된 것 같았는데 마지막에 깼을 때가 여섯시 십분이었다. 그냥 일어났다. 영어 공부하고 씻고 커피 내려 마셨다. 케냐 토마토 원두에서 여전히 토마토 맛은 나지 않았다. 주말에 산 <프로그래머 앳 워크>를 읽고 있다. 

한 주 좀 넘게 작업했던 파트너 어드민 작업은 마무리 했다. 이제 신규 풀 추가, 몇 달 간 미뤄뒀던 AI 분석 배치 잡을 만들어두려고 한다. 스크랩하는 잡도 지금 너무 오래 돌아서 최적화가 필요할 것 같다. 거의 하루에 만원씩 나가는 것 같다. n개로 병렬처리 해서 총 실행 시간을 줄이더라도 컴퓨터 사용 시간은 늘어나는 것이니 비용은 비슷할 것 같다. GCP 프리티어도 다 써가서 다른 프리티어 계정으로 마이그레이션 해야 한다. 이 기간이 끝나면 아예 GCP를 안 쓰는 게 나을 수도 있겠다. 너무 비싸다. 

스크랩 컨테이너에 대한 대시보드 구축이 필요할 것 같다. 매일 얼마나 하는지 얼마나 성공하고 실패하는지 문제가 있는 세션은 없는지 등등. Claude code랑 잠깐 구현하다보니 databricks에서 사용하던 것처럼 SQL 입력 > 그래프 선택 > 대시보드 추가 하는 형태의 라이브러리를 구현하면 좋겠다는 생각이 들었다. 당장할 것은 아니지만 TODO.

오늘부터 다시 AI 분석 모듈 시작한다. 필요한 것 맞는데 당장 서비스 크리티컬은 아니다보니 몇 개월을 미뤘다. OpenAI든 Google AI든 배치 형태로 하면 최대 반 정도 할인이 된다고 한다.
클로드가 코드를 작성할 때 SSOT를 자꾸 잊는다. CLAUDE.md에 명시를 해두었는데도 실수한다.

어제 퇴근하고 버스 타러 내려가는 길에 눈이 와서 그런지 평소보다 더 고요했다. 건물로 둘러싸인 길을 걸어내려가는데 그 고요한 느낌이 좋았다.

## 20260114

춥다. 서울 버스 파업이라 오늘도 힘들게 왔다. 요새는 매일 아침 몽벨 비니를 내 것은 아니지만 내 것처럼 쓰고 다닌다. 내 것은 아니지만 내 것처럼 끼는 장갑도 있다. 자전거를 안 탄지도 벌써 2~3주 되었다. 더운 날만 아니면 괜찮은 것 같다. 올해의 두번째 책 <프로그래밍 앳 워크>도 거의 다 읽어간다.
어제 종일 배치 모듈 만들려고 보고 있었는데 Free tier에서는 Batch API는 사용 불가능하다. 실시간으로 분석하는 프로그램을 먼저 만들고 추후에 Batch API를 만들어야 할 것 같다.
Google AI Studio에서 결제 계정을 지정하면 tier1을 받고 free tier 할당량을 사용할 수 있다. BatchAPI를 그대로 쓸 수 있을 것 같다. 어제 분석기 모듈을 설계하면서 재밌었다. 예전만큼 꼼꼼히는 아니지만 이 프로젝트를 시작하고 이렇게 찬찬히 코드를 들여다보면서 고친 것은 처음인 것 같다. 느리지만 확실히 할 수 있어서 좋았다. AI가 쓴 코드로부터도 배운다. `Promise.allSettled()`는 `Promise.all`과 달리 중간에 몇 개가 실패하더라도 끝까지 간다. 이번 분석기는 npm 대신 bun을 사용해봤다. 속도만 놓고 단순 비교해보면 오히려 안 쓸 이유가 없을 것 같다. 모르는 것이 많지만 하나씩 조금씩 배운다. 

점심 먹고 학교 도서관에 들어가봤다. 건물은 낡았는데 내부는 새것 같다. 깔끔해서 좋다. 한 번 가서 책도 읽고 낮잠도 자면서 시간 보내고 싶다.

내 개인계정 GCP Free tier가 몇 만원 남지 않아서 늦지 않게 다른 계정으로 갈아타야 한다.

## 20260115

어제는 잡다한 운영 문제들이 많아서 하나에 집중하기 어려웠다. Gemini Files API로 이미지 업로드, JSONL 파일 생성, Batch API submit까지 만들었다. 결과도 대충 잘 나온다.
ig scrape job을 다른 계정으로 이전했다.

## 20260116

어제는 가정의 날이었다. 일주일에 한 번 일찍 퇴근하는 날이다. 동네에 새로 생긴 식당에서 저녁 먹었다. 후토마키, 바지락술찜, 시샤모 구이, 청하까지.
아침에 공부도 하고 씻고 커피도 내려마시고 책도 좀 읽으니 아홉시여서 오랜만에 자전거 타고 왔다. 날이 풀렸고 눈은 다 녹았다.

어제 이전해둔 job은 문제 없이 잘 돌았다. 새 계정으로 어제 테스트를 좀 했더니 벌써 5만원이 나왔다.
Gemini API의 rate limits가 타이트 해서 여러 모델을 한계까지 사용하는 전략을 써야 한다. 2.0부터 3.0까지 다양한 모델을 쓰게 했다. 각 모델마다 3백만에서 1천만 토큰까지 처리량이 다양한데 그래도 턱없이 모자르다. 한 400개 정도 하면 모델마다 다르지만 약 300만 토큰 정도 된다. 
Free tier를 다 소진하고 나면 Gemini/GPT 등 너무 비싼 모델 말고 좀 더 저렴한 모델을 찾아봐야 할 것 같다.
이미지 모아서 여러 모델들에 병렬로 upload/submit 하는 것까지 만들었다. 오늘은 status check poller랑 결과를 저장하는 모듈을 작업하면 어느 정도 마무리 할 수 있을 것 같다. 시간 남으면 playwright worker도 이전해둬야 한다.
점점 다시 코드 진행을 못 따라가고 있다. 자세히 코드를 읽기가 힘들다.

Poller와 Saver를 분리할 이유가 없는 것 같다. 폴링 해서 있으면 저장할 건데 두 개루 분리해서 관리할 필요가 있을까? 합치기로 했다.

Poller-save 모듈을 설계하다보니 배치 상태를 고유하게 관리할 수 있는 테이블이 없다는 것을 깨달았다. 배치를 생성하는 시점 이후부터 배치 라이프사이클을 관리할 수 있는 테이블을 설계에 추가했다.

우리는 점심시간에 종종 공차 사먹는다.

poller, saver 코드를 작성했다. poller/saver를 코드 레벨에서만 분리해두었다. result parser에 대한 단위 테스트와 save, polling, tag save에 대한 통합 테스트를 작성했다. 코드를 자세히 읽고 클로드 코드에게 지시하고 테스트를 작성하는 과정은 시스템을 이해하고 통제할 수 있다는 자신감이 생긴다. 하지만 말 그대로 '바이브' 코딩할 때에 비하면 몇 배는 느린 것 같다. 물론 이것은 느낌이다. 초안을 작성할 때 바이브 코딩이 훨씬 빠르다고 해도 그 이면에 제대로 로직을 파악하지 못해서 발생하는 문제들이 있다. 테스트 부족으로 인한 운영 이슈 혹은 계속 말씨름 하면서 낭비해야 하는 시간. 뒤늦게 발견하고 수정하는 시간까지 더한다면 처음에 조금 느리고 확실하게 한다고 해서 확실하게 더 느리다고 단언할 수는 없다. '처음에 확실하게' 하는 방식에서도 바이브 코딩에서 발생할 수 있는 문제가 그대로 발생할 수 있다. 추측이지만 코드 관여 수준이 다르기 때문에 문제 대응 능력도 차이가 있을 것이다.
바이브와 바이브 아님의 문제가 아닌 것 같다. 어쨌든 작성은 자연어로 지시하니까. 난 코드를 한 라인도 작성하지 않는다. 모든 코드는 에이전트가 작성한다. 다만 얼마나 꼼꼼하게 검토하고 테스트 하고 이해하려고 노력하는가에 달린 것 같다. 내가 읽고 이해하려고 노력한 만큼만 이해할 수 있다. 모든 작업을 이렇게 할 수는 없고 어떤 태스크에 집중해야 하고 어떤 태스크에 덜 집중해야 하는지 결정하는 것이 중요할지도 모르겠다.

테스트 환경은 bun과 testcontainer가 아직 호환되지 않아서 docker compose로 로컬에서만 실행 가능하게 구축했다. 이 정도만 해도 지금 단계에서는 충분히 좋다.

## 20260118

일요일이다. 어제는 한시간 사십분을 버스타고 친구들이 하는 카페에 다녀왔다. 여행하는 기분이었다. 오늘은 freeCodeCamp에서 제공하는 Python 강의를 들어보려고 한다.

## 20260119

한 주 시작이다. 주말엔 <에이전틱 AI 시스템 구축하기>와 <사실은 의견일 뿐이다>를 읽었다. 사실은 의견일 뿐이다는 생각보다 재미 없다. 읽긴 했는데 머리에 잘 안 들어왔다. 에이전틱 AI..는 생각보다 재밌게 읽었고 쉽고 알찬 내용이다. 내가 만드는 서비스에 어떻게 에이전트를 구축할 수 있을까 생각하면서 읽었다. 아직 명확한 상은 그려지지 않지만 단순히 로직을 순차적으로 실행하는 워크플로우가 아니라 어떤 식으로 접근해야 '에이전트'에 가까워질 수 있는지 조금씩 생각해보고 있다.

이번주는 수요일까지 AI 분석 모듈 마무리 해야 한다. 모듈 자체는 순항 중이긴 한데 서비스 필터도 수정해야 한다. 그리고 카테고리 확장.

점점 설계가 중요해진다는 말이 Facebook, LinkedIn에서 많이 보이는데 규모와 사례에 맞는 베스트 프랙티스 설계 skills, claude.md를 정교하게 작성하고 그것을 누구나 가져다 쓸 수 있다면 그런 능력 마저도 (지금보다는) 덜 중요해지는 게 아닐까? 하는 생각이 들었다. 마침 Vercel에서 [Agent Skills repository](https://github.com/vercel-labs/agent-skills)를 공개했다. 난 Next.js, React, Typescript로 서비스를 만들고 있지만 아직 이 생태계에 익숙하지 않고 무엇이 베스트 프랙티스인지 잘 모른다. 하지만 이 skills를 사용하면 100%는 아니더라도 베스트 프랙티스를 어느 정도 흉내낼 수는 있을 것이다. 어쩌면 그것으로 충분할지도 모른다. 그러니까 모든 서비스에서 베스트 프랙티스를 준수하고 그래야만 비즈니스를 할 수 있는 것은 아니니까 말이다. 지속 가능한 서비스를 만드는 데 있어서 인간이 소프트웨어 구성 요소를 얼마나 이해하고 있느냐는 여전히 중요한가. 성능, 장애 복구, 보안, 검증의 영역에서 예전보다는 아니지만 아직은 그렇다. 말 그대로 아직일 뿐이고 그것마저 빠른 속도로 AI가 대체할 것 같다. 그러고 나면 뭐가 남을까? 내가 나름대로 해왔던 일의 가치가 0에 수렴하고 있다는 사실은 더 많은 것을 시도해볼 수 있다는 가능성이 열리는 일이면서도 그것을 내가 아닌 누구나 할 수 있다는 사실 때문에 무기력해지는 일이기도 하다.

아무튼. 다음으로 읽을 책은 알렉스 쉬의 <가상 면접 사례로 배우는 대규모 시스템 설계 기초 2>이다. 1도 내 이삿짐 박스 어딘가에 있을 텐데 아직 전부 읽지는 못했다. 2는 전자책으로 작년에 구매했고 역시 한 챕터 읽고 말았다. 오늘 출근 버스에서 광고 클릭 이벤트 집계 챕터 읽었다. 어제는 주변 친구 챕터를 읽었고. 유스케이스에 따른 데이터베이스 선택을 해야 할 때 RDB를 가장 먼저 떠올리고 좀 더 나아가면 Elasticsearch, Redis 같은 것을 떠올릴 수 있지만 그 외에 선택지는 잘 모른다. 필요하면 CC가 도움을 주겠지만 관련 책을 좀 읽어둘 필요가 있겠다. <세븐 데이터베이스>라는 책을 GPT가 추천해줬다. 알아야만 할 것 같은 것들 알면 좋은 것들에 대한 리스트는 무한대여서 자꾸 압도 당한다.

## 20260120

아침에 출근해서 GCP 확인했는데 크레딧을 다 썼다. 13만 6천개 Batch API로 돌려도 40만원이다. 아직 7만개 정도 남았고, +@로 계속 늘어날 거다. 이번엔 gemini rate limit 때문에 2.0~3.0까지 다양하게 써서 비용이 더 많이 나왔을 것이다. 5천명을 더 추가하고 싶다는데, 지금 15일간 비용이 16만원 정도인데 x2하면 30만원으로 늘어나는 셈이다. 전략을 바꿔야 한다. 근데 시간은 없다. 바로 이어서 예정된 작업도 있고, GCP 계정을 다시 옮겨야 한다. 여러모로 정신없는 아침이다. 배고프다.

오후에는 다 같이 서비스 사용해보면서 수정해야 할 부분들 얘기했다. 서비스가 굉장히 단순한 것 같기도 하고 복잡한 것 같기도 하다. 탐색 > 시딩이 전부인 서비스여서 그랬는데, UI/UX가 말처럼 그렇게 단순하지는 않기 때문에 복잡하다고 생각했다. 어디를 어떻게 개선해야 할까? 그래야 본질에만 집중할 수 있을까? 서비스를 둘러보는 동안에도 좋은 아이디어는 생각나지 않았다. 다양한 직군에서 콜드 메시지 니즈가 제법 있는 것 같은데 간단한 수준으로 데스크톱 앱 만들어 볼 수 있을 것 같다.


## 20260121

- 총 에셋: 207,740건

- 세부 내역
  - 새 프롬프트 분석 완료: 139,258건
  - 이전 프롬프트 분석 (재분석 예정): 53,429건                                                                                                                                                         
  - 실패: 15,053건
    - mp4 썸네일로 보류: 약 3,500건                                                                                                                                                       
    - 기타 실패: 약 11,500건 (우선순위 아닌 것 같아서 추후 확인)

- 오늘 작업 예정
  - 이전 프롬프트 분석분 53,429건 재분석 실행(패션만)
  - UI에 새로운 필터 반영

크리에이터 탐색 쪽 Front/Server 할 것 없이 개판이다. 어떻게 손대야 할지도 모르겠고 일단 vercel-react best practice에 의존하고, 내가 보기에 과도한 것들 이해 안 가는 것들 물어보면서 조금씩 개선 중이다. 필터 UI 추가하려고 보니까 최소 10곳은 넘게 수정하는데 이거 SSOT로 변경하려니까 줄이고 줄여도 줄여지지가 않는다. 그러다 문득 key를 eng - ko 매핑하는 것 외에 이것을 타입을 정의해서 strict하게 사용해야 하는 이유가 뭘까?라는 의문이 들었다.

카테고리 확장하기 전에 챙겨야 할 것
- 스크래핑 타겟팅 좁히기 (캠페인 진행 중인 크리에이터) 
  - daily: 캠페인 진행 중인 크리에이터  
  - weekly: 전체

- ai 분석:
  - 매일 분석 안된 애들 대상

## 20260122

## 20260123

어제는 갑자기 데이터베이스에 문제가 생겼다.

- storage 정리

태그 관련
- genderless 삭제
- age tag 뷰티 배포하면서 마이그레이션
- 상위 100명 먼저 돌려보고 판단
- 어드민 추가

우려되는 것
- 카테고리에 맞는 감도가 필요하다. 현재는 통합.
- 카테고리에 맞지 않는 이미지를 제외할 수 있어야 한다. -> 프롬프트에 카테고리 부적격 처리 추}가
-  

## 20260124

토요일이다. 오늘은 아침 6시부터 저녁 9시인 지금까지 책상 앞에 앉아 있었다. 우리 서비스 Tauri를 사용해서 데스크톱 앱으로도 감싸보고, 원격 브라우저를 사용하던 부분을 Tauri 로컬 앱에서 직접 브라우저를 띄우는 방식도 적용해봤다. 바로 고 투 프로덕션 하기는 어려울 것 같기는 한데 조금만 손보면 원격 브라우저 로그인 문제를 해결할 수 있을 것 같다. 병렬로 메시지 오토메이션 매니지먼트 시스템..이라고 하면 조금 거창하지만 아이디어도 한 번 구현해봤다. 실제로 로직을 만든 건 아니고 껍데기만 만들었다. 분명히 니즈가 있을 것 같은데 만든다고 하더라도 혼자서 어떻게 접근해야 할지 모르겠다. 오전에는 claude code랑 nvim 초기 설정한다고 삽질을 좀 했는데 nvim docs 들어가보니까 그냥 초기 세팅 지원해주더라. 내가 vim에 적응할 수 있을지 모르겠다. 초기 진입 장벽이 너무 높다. 에디터 명령도 그렇지만 프로젝트 레벨에서 사용하려면 더더더. 내가 VSCode를 잘 쓰는 것은 아니지만 그만큼만 쓰려고 하더라도 오래 걸릴 것 같다. IntelliJ는 그나마 좀 쓴다고 생각했는데 켜보지 않은지도 오래 되었다. VSCode는 이직하고 Typescript 생태계로 넘어오면서 본격적으로 쓰기 시작했는데 AI Agent 시대와 맞물려서 에디터를 가지고 해야 할 일은 많지 않았다. 

mkdir -pv 명령을 배웠다. mkdir -p는 어떤 약어인지 모르겠는데 mkdir -p a/b/c 하면 a/b/c 경로로 디렉터리가 만들어진다. -v는 verbose다. 난 verbose라는 단어가 마음에 든다. 장황한. 내가 좀 그래서 그런가.

아이디어를 구현하는 비용이 0에 수렴하므로 빨리 무언가를 많이 만들어보라는 조언과 기본으로 돌아가라는 조언 그 두 개의 조언이 둘 다 맞는 말인 것 같고 뭔가를 만들면서 기반 지식들을 탄탄하게 만드는 것을 어떻게 같이 할 수 있을까? 나에게는 항상 그것이 상반되는 것 같다. 만드는 것에 집중하면 기반 지식을 탄탄히 하기 어렵고 기반 지식에 집착하면 무언가 만들기 어렵다. 그런 것 같다. 


## 20250125

일요일이다. 알람 울리기 전에 일어났다. 한시간 공부하고 한시간 멘탈리스트 보고 잠들었다. 일어나서 마라샹궈 먹었다. 처음 먹어봤다. 로버트 C. 마틴의 책 We, Programmers를 조금씩 읽고 있다. 문득 이 사람이 만든 소프트웨어가 무엇인지 궁금해져서 찾아봤지만 내가 아는 프로그램은 없었다. 그게 중요할까? 좋은 책을 쓰는 것과 좋은 소프트웨어를 만드는 것은 완전히 다른 일일 텐데. 책을 찾아볼 때마다 읽어야 할 것 같은 책의 목록을 늘어만 간다. 에단 호크는 읽어야 할 책 말고 읽고 싶은 책을 읽으라고 했다. 조언이라는 것이 원래 그렇듯 내 상황에 적용하려고 하면 도통 잘 들어맞지가 않는다. Tauri로 만든 서비스를 출시까지 해볼까? 싶은데 의욕이 안 생긴다. 될 것 같기는 한데 그것을 어떻게 알려야 할지 모르겠다. 그런 생각을 하다보면 결국 귀찮아지고 마는 것이다. 그냥 책이나 읽자. 그게 제일 편하니까. 그렇게 된다.

## 20260126

월요일이다. 크리에이터 스코어를 카테고리 단위로 나누고 검수하기 편하게 썸네일 여러개로 늘리는 작업 먼저 해야 한다. 그리고 시간 남으면 필터 쿼리 개선할 수 있겠다.
오전에 어드민 검수 채널 썸네일 늘리고 스코어 카테고리 별로 나눴다. 어드민에서 썸네일 개술르 4 -> 8로 늘리려고 헀는데 숫자를 바꾸어도 안 늘어나길래 SSOT 위반이라는 것을 바로 알 수 있었다. 클로드 코드가 매번 전체 코드를 탐색할 수 없기 때문에 이런 경우에 자주 하드 코딩하는 것 같다. size 코드가 곳곳에 분산되어 있는 것이다. 단일 소스를 참조하도록 맞추는 작업을 했다. SSOT는 중요하다. 한 두 번 하드코딩 하기 시작하면 나중에는 겉잡을 수 없어진다. Tag 필터를 하나 추가하려면 열 개 이상을 파일을 열어봐야 하는 것처럼 말이다. 

주말 내내 스크래퍼 잡이 돌지 않았다. 스케줄러 오류가 있길래 수정했는데 여전한 것 같다. 왜일까?

DHH의 글은 재밌다. 
- [Finished Software](https://world.hey.com/dhh/finished-software-8ee43637)
- [Finding The Last Editor](https://world.hey.com/dhh/finding-the-last-editor-dae701cc)

새로 알게 된 [37Signals 팟캐스트](https://37signals.com/podcast/)

Linus Torvals가 TED 인터뷰에서 말한 것처럼 잘하는 사람ㅡ여전히 '잘한다'는 의미가 무엇인지 정확히는 모르지만ㅡ들은 취향taste이 있는 것 같다. 내 취향은 뭔가? intellIJ? VSCode? 그것도 한참 모자르다. 취향은 어떻게 만드나. 난 취향이 선망envy에서부터 출발한다고 생각한다. 선망의 대상으로부터 출발해서 그 사람이 좋아하는 것. 그 사람이 영향 받는 사람. 그 사람이 영향 받는 사람이 좋아하는 것. 그 사람이 영향 받은 사람이 영향 받은 사람. 그렇게 가지를 뻗어나갈 수 있다.

Joel on software의 [Things You Should Never Do, Part I](https://www.joelonsoftware.com/2000/04/06/things-you-should-never-do-part-i/)

```
이 원칙의 결과로, 오늘날 거의 모든 프로그래머에게 그들이 작업하는 코드에 대해 물어보면 "완전 엉망진창이에요."라고 대답할 것입니다. "그냥 다 버리고 처음부터 다시 시작하고 싶어요."
As a corollary of this axiom, you can ask almost any programmer today about the code they are working on. “It’s a big hairy mess,” they will tell you. “I’d like nothing better than to throw it out and start over.”

처음부터 다시 시작할 때는 이전보다 더 나은 결과를 낼 수 있을 거라고 믿을 이유가 전혀 없다는 점을 명심해야 합니다 . 우선, 첫 번째 버전을 만들었던 프로그래밍 팀과 같은 팀이 아닐 가능성이 높으므로 실제로 "더 많은 경험"을 가지고 있다고 볼 수 없습니다. 오히려 이전의 실수를 대부분 반복하고, 원래 버전에는 없었던 새로운 문제점들을 만들어낼 가능성이 큽니다.
It’s important to remember that when you start from scratch there is absolutely no reason to believe that you are going to do a better job than you did the first time. First of all, you probably don’t even have the same programming team that worked on version one, so you don’t actually have “more experience”. You’re just going to make most of the old mistakes again, and introduce some new problems that weren’t in the original version.
```

엄청나게 많은 것이 바뀌는 동안 이런 것은 하나도 바뀌지 않았다.

## 20260127


`Finding The Last Editor`에서 DHH는 잠깐 Polglot Programming에 대해 얘기한다. 세상에 그런 재능있는 개발자들이 있다는 것을 알지만 자신은 그런 종류의 사람이 아니라고. 여섯시 삼십분에 문득 그 말이 생각났다. 

ry가 사주아이라는 서비스를 공유해줬다. 990원으로 사주를 봐주는 서비스다. 만든 사람이 궁금해서 찾아보니 [노마드 코드 커뮤니티](https://nomadcoders.co/community/thread/11490)에 스레드가 있었다. ID로 미루어보았을 때 나와 동갑이다. 3달만에 20만 유저가 가입했다고 한다. 지금은 50만이라고 사이트에 표기되어 있다. GitHub, LinkedIn도 찾아보니 확실히 나랑 동갑이고 22~23년에 컴퓨터 공부를 시작해서 24년부터 소프트웨어 엔지니어로 일하기 시작한 것 같다. 커뮤니티 글에 따르면 적어도 20만 유저를 모을 때까지 혼자서 한 것 같은데 엄청 대단하다. 

두 사람이 외부 미팅 가서 오늘 점심 혼자 먹었다. 그동안 해보고 싶었던 중앙 도서관 구경을 했다. 크고 넓고 멋진 도서관이다. 층마다 엄청나게 많은 책들이 있다. 도서관과 엄청나게 많은 책이라니 당연한 말이지만 말이다. 컴퓨터 과학 섹션에는 인터넷 초창기 시절 책부터 딥러닝에 이르기까지 누적된 역사가 책 목록에서 다 보였고 그게 좀 재미있었다. 남궁성님의 플래시로 배우는 자바.. 난 그로부터 십년도 뒤에 나왔을 개정판 자바의 정석으로 프로그래밍을 공부했다. 그때를 생각하면 아득하다. 아주 긴 시간이 지난 것 같은데 고작 육 년 정도가 지났다.

새 카테고리 분석도 마무리 되어 간다. 파트너 플랫폼 대시보드가 갱신되지 않는 이유를 찾아서 고쳐야 하고, 추천 스코어 분리 작업을 해야 한다.


[“I’d love to start a company / become a great programmer / write an awesome blog, but there’s just not enough time in the day!” Bullshit. There’s always enough time, you’re just not spending it right."](https://signalvnoise.com/posts/1619-theres-always-time-to-launch-your-dream) 이건 정말인 것 같다. There's always enough time. 회사를 그만두고 창업팀에 합류하고 하루에 열두시간씩 일하지만 9to6, 9to5로 일하던 시절보다 더 많은 책을 읽고 더 많은 시간을 공부하는 데 쓴다. 시간이 부족하니까 역설적으로 시간을 더 아껴쓰게 된다는 사실에 대해 요새 자주 생각한다.

37 signals의 [소개 페이지](https://37signals.com/)는 정말 멋지다. 

패션 캠페인 분석 프롬프트 경로를 변경해서 일주일 전에 머지했는데, 경로 인식 실패로 AI 분석 실패하는 이슈가 있따는 것을 오늘에서야 알았다. 클로드 코드는 빌드 캐시 때문일 거라고 추측한다.
그래도 ry가 보고해주지 않았다면 에러 로그를 직접 보기 전까지 몰랐을 거다. 이건 정말 문제다.

  ┌─────────────┬───────────────────────────────────────────────────────────────────────────────────┐
  │    기간     │                                       상태                                        │
  ├─────────────┼───────────────────────────────────────────────────────────────────────────────────┤
  │ 1/21 ~ 1/26 │ Sentry의 withSentryConfig 래퍼가 빌드 설정에 영향을 주거나, Vercel 빌드 캐시 사용 │
  ├─────────────┼───────────────────────────────────────────────────────────────────────────────────┤
  │ 1/26 오후   │ Sentry 제거 → pnpm-lock.yaml 대규모 변경으로 Vercel 클린 빌드 발생                │
  ├─────────────┼───────────────────────────────────────────────────────────────────────────────────┤
  │ 1/27 오늘   │ 클린 빌드된 배포에서 outputFileTracingIncludes에 누락된 경로 문제 노출            │
  └─────────────┴───────────────────────────────────────────────────────────────────────────────────┘

지속적인 모니터링이 필요하다고 생각하여 sentry를 설치했었는데 설치 하고 거의 보지 않았다. 보긴 봤는데 연동이 잘 안 된 건지 로그를 보기 힘들어서 잘 보지 않았다. 현재 규모에서 Vercel Logs로도 충분한 것 같아서 문제가 생기면 Vercel Logs로 봤고 대부분 로그를 Vercel에서 확인해도 충분했다. 그래서 그냥 방치만 하다가 어제 걷어냈다. Sentry 설치 이후로 빌드 시간이 거의 2배 늘었는데 다시 2배 줄어들었다. 4분-5분 가까이 걸리던 것 빌드 시간이 2분 초반대로 확 줄었다. 

[How do you turn inspiration into skill?](https://signalvnoise.com/posts/2412-how-do-you-turn-inspiration-into-skill)을 읽고 느낀 생각. 난 inspiration 중독이다.


## 20260128

망한 것을 되돌리기는 어렵다. 처음부터 잘해야 한다. 하지만 처음부터 잘할 수는 없다. 그런 생각이 아침에 들었다. 어렵다.

오늘 뉴 카테고리 오픈 했다. 태그 분석 방식이 확장하기 어렵기 때문에 임베딩 방식을 제안했다. 이론적으로 임베딩으로부터 거꾸로 태그를 추출하는 게 가능하지 않을까 싶다. 텍스트 서치로 태그에 대한 설명과 태그와 비슷한 이미지를 넣어서 검색하고, 그 결과로 나온 것을 1차 검수해서 레이블링을 하면 되지 않을까? 

포엣코어, 그래놀라 등을 추가해도 유행은 빠르게 변한다. 몇 년 전 유행했던 '올드머니'처럼 더이상 아무도 사용하지 않는 용어가 된다. 새로운 코어가 유행하면 재분석을 해야 하는데, 수십만원 이상 비용이 든다. 개선 비용이 비싸다는 것은 자주 개선하기 어렵다는 의미다. 
이미지를 임베드 하고 벡터 서치 방식을 적용하면 많은 몇 가지 문제를 해결할 수 있다. 필터 검색만으로 분류하기 어려운 애매한 검색이 가능해진다. 이미지를 통해 유사 이미지를 검색할 수 있고 새로운 분류 체계가 나오더라도, 그 분류 체계와 비슷한 이미지 또는 그것을 설명하는 텍스트로 유사 이미지를 찾고 사전 분류가 가능해진다. 예를 들어 새로운 유행이 '수영코어'라면 수영복을 설명하는 텍스트 또는 그와 유사한 이미지로 수영코어 이미지를 사전 분류해 둘 수 있다. 더 유연하고 비용도 저렴하다. 물론 이론적으로 그렇다는 것이지 이것이 얼마나 정확한지는 또 다른 문제다. Azure, GCP 등 무료 크레딧을 사용해서 검증해볼 가치는 충분하다.

내 개인계정 GCP 크레딧을 다 써가서 디엠 워커도 새 계정으로 옮겨야겠다.
다양한 클라우드 업체에서 스타트업을 위한 서포트 크레딧을 제공한다는 것을 알게 되었다. 이걸 활용해서 임베딩-벡터 서치 PoC를 해볼 수 있을 것 같다.

## books

1. ELOQUENT JAVASCRIPT 4th Edition(2024) / Marjin Harverbeke(마레인 하버비케)

한국어 제목은 <자바스크립트 스킬업>이다. eloquent가 모두에게 친숙한 영어 단어는 아니기 때문에 그런 것이겠지만 그렇다더라도 eloquent를 '스킬업'으로 바꾼 것은 아쉬운 결정이다. 그럴 거면 <일로퀀트 자바스크립트>라고 음차하는 게 낫겠다.
자바스크립트 기초를 다져야겠다고 생각하고 꺼내 든 책. 2024년 출간할 때 사두고 조금 읽고 말았는데 처음부터 다시 읽었다. 뒤로 갈수록 생각보다 난이도 있는 내용이 많이 나왔다. 자바스크립트 코드에 익숙하지 않아서 잘 이해되지 않는 내용도 많았다. 저자가 자바스크립트에 통달해서 이렇게도 해보고 저렇게도 보여주면서 자바스크립트란 이런 거라고 보여주는 것 같았는데 그의 자유분방함에 비해 내 자바스크립트 실력이 형편없어서 따라가기는 어려웠다. 실습 챕터에서 그게 많이 드러난다. 출퇴근 길에 읽어서 실제로 타이핑 하면서 읽지는 못했다. 주말에 하려고 마음 먹었지만 역시 타이핑은 하지 않았다. 

2. Programmers At work / 수전 래머스 저자(글) · 박재호 번역

한국 제목은 <오래된 인터뷰, 개발의 미래를 긷다1>인데 실제로 인터뷰 모음이라는 점에서 단순하지만 페이스북에서 누군가 번역한 것처럼 "일터의 프로그래머"가 더 잘 어울린다. 부제는 'PC 시대의 영웅들'인데 완전히 맞는 말이다. 그들은 천공카드 시절부터 프로그램을 작성했다. 아무런 레퍼런스 없이 메모리가 고작 몇 KB였던 시대에 스프레트 시트, 워드프로세스, 운영체제 같은 것을 설계하고 만들었다. 그들은 기계(PC)가 달라지면 달라진 기계에 이식하기 위해 코드를 다시 작성해야 했다. 어셈블리로 코딩했고 C는 비교적 최신 언어였다. 세상은 완전히 달라졌지만 그들의 작업에 접근하는 방식은 과장해서 하나도 달라지지 않았다. 어떤 방법론이 탄생하기 전부터 그것은 존재하고 어쩌다 어떤 이름이 우연히 널리 사용하게 되었을 뿐이다. 누가 어떤 방법론을 만들고 그 이후부터 세상이 갑자기 그 방법론을 채택하는 것이 아니다. 몇 년도부터 몇 년도까지는 이 방법론. 몇 년도부터는 저 방법론. 그런 단순한 타임라인으로 구분할 수는 없다. 어쨌거나 놀라운 사람들 이야기가 담긴 재밌는 책이다. 이제 막 PC 시대가 시작되고 있었고 대부분 사람들은 PC가 무엇인지도 몰랐다. 지금도 비슷한 시기인 것 같다. 몇 년 전까지만 해도 LLM, ML, DL 이런 것을 거의 아무도 몰랐고 알아도 관심있는 사람들은 적었다. 지금이야 모든 지구인이 AI 열광하지만 지금이 있기까지 지금까지 수십년을 사람들 몰래 발전했을 것이다. 또 수십년 지나면 AI 시대 영웅들이라는 인터뷰집도 나오겠지. 지금은 대AI항해시대 같다. 링크드인을 보면 모두가 창업하고 있는 것처럼 느껴질 정도다. 2025년은 나에게 있어서도 완전히 역사적인 한해였는데 일을 하는 방식이 완전히 바뀌었기 때문이다. 여기에 대한 감상을 까먹기 전에 남겨둬야지.

3. 알아서 잘하는 에이전틱 AI 시스템 구축하기 / 안자나바 비스와스, 릭 탈루크다르 지음, 김모세 옮김

원제는 'Building Agentic AI Systems'인데 한국어 제목에는 '알아서 잘하는'이라는 불필요한 접두어가 붙었다. '알아서 잘하는'은 에이전틱 AI 안에 이미 내포되어 있는 속성이어서 되풀이 할 이유가 없어보이는데 아쉽다. 이 결정 때문에 제목이 유치해졌다.

4. 사실은 의견일 뿐이다 /. 옌스 포엘 지음, 이덕임 옮김 

제목이 재밌어보여서 구매.
